---
layout: null
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>machine yearning chat</title>
  <!-- Prevent flash by applying theme immediately -->
  <script>
    (function() {
      // Check for saved theme preference or use prefer-color-scheme
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        document.documentElement.setAttribute('data-theme', savedTheme);
      } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.setAttribute('data-theme', 'dark');
      }
    })();
  </script>
  <!-- Add Space Grotesk font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="chat-style.css">
  <!-- Dynamic Prism theme selection -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-solarizedlight.min.css" id="prism-light-theme">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-tomorrow.min.css" id="prism-dark-theme" disabled>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-mongodb.min.js"></script>
  <!-- Include showdown.js for Markdown conversion -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
  <!-- Include marked.js for Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- Include the unified chat converter -->
  <script src="chat-converter.js"></script>
  <!-- Include the chat directory scanner -->
  <script src="chats-directory.js"></script>
  <!-- Theme switching script -->
  <script>
    // Function to toggle theme stylesheets
    function togglePrismTheme(isDark) {
      document.getElementById('prism-light-theme').disabled = isDark;
      document.getElementById('prism-dark-theme').disabled = !isDark;
      
      // Re-highlight any code blocks to properly apply the new theme
      if (window.Prism) {
        setTimeout(() => {
          Prism.highlightAll();
          enhanceCodeBlocks(); // Re-add language tag and copy button
        }, 100);
      }
    }
    
    // Apply current theme on load
    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    togglePrismTheme(currentTheme === 'dark');
    
    // Watch for theme changes
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.attributeName === 'data-theme') {
          const theme = document.documentElement.getAttribute('data-theme');
          togglePrismTheme(theme === 'dark');
        }
      });
    });
    
    observer.observe(document.documentElement, { attributes: true });
  </script>
  
  <!-- Script to add language tag and copy button to code blocks -->
  <script>
    function enhanceCodeBlocks() {
      console.log("Enhancing code blocks");
      
      // Find all pre elements
      document.querySelectorAll('pre').forEach(pre => {
        // Skip if already enhanced with copy button
        if (pre.querySelector('.copy-button')) return;
        
        // Get language from class or data attribute
        let language = pre.getAttribute('data-language') || 'code';
        
        // If no data-language attribute, try to get from class
        if (language === 'code') {
          const preClasses = [...pre.classList];
          const codeElement = pre.querySelector('code');
          const codeClasses = codeElement ? [...codeElement.classList] : [];
          
          // Try to find language class in pre first, then code
          const preLanguageClass = preClasses.find(cl => cl.startsWith('language-'));
          const codeLanguageClass = codeClasses.find(cl => cl.startsWith('language-'));
          
          if (preLanguageClass) {
            language = preLanguageClass.replace('language-', '');
          } else if (codeLanguageClass) {
            language = codeLanguageClass.replace('language-', '');
          }
        }
        
        console.log("Found code block with language:", language);
        
        // Set data-language attribute on pre element
        pre.setAttribute('data-language', language);
        
        // Also set data-lang on code element for compatibility
        const codeElement = pre.querySelector('code');
        if (codeElement) {
          codeElement.setAttribute('data-lang', language);
        }
        
        // Add copy button (separate from language tag for clarity)
        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-button';
        copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>';
        copyBtn.title = 'Copy to clipboard';
        
        copyBtn.addEventListener('click', () => {
          const code = codeElement ? codeElement.textContent : pre.textContent;
          navigator.clipboard.writeText(code).then(() => {
            copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
            setTimeout(() => {
              copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>';
            }, 2000);
          });
        });
        
        // Remove any existing copy buttons (just in case)
        const existingCopyBtn = pre.querySelector('.copy-button');
        if (existingCopyBtn) {
          existingCopyBtn.remove();
        }
        
        // Add the copy button directly to the pre element
        pre.appendChild(copyBtn);
        
        // Make sure pre has position relative for absolute positioning
        pre.style.position = 'relative';
        pre.style.marginTop = '30px';
      });
    }
    
    // Apply after Prism highlighting
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM loaded, scheduling code enhancement");
      setTimeout(enhanceCodeBlocks, 500); // Allow time for Prism to highlight
      
      // Re-apply a few more times to catch any dynamically loaded content
      setTimeout(enhanceCodeBlocks, 1000);
      setTimeout(enhanceCodeBlocks, 2000);
    });
  </script>
</head>
<body>
  <div class="site-header">
    <a href="index.html" class="site-title">
      <h1>machine yearning</h1>
    </a>
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
      <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zm-9 4.5H1v-3h2v3zm20 0h-2v-3h2v3zM12 1v2c0 .55-.45 1-1 1s-1-.45-1-1V1h2zm0 20v2h-2v-2c0-.55.45-1 1-1s1 .45 1 1zm7.4-15.4l-1.4 1.4c-.39.39-1.02.39-1.41 0-.39-.39-.39-1.02 0-1.41l1.4-1.4 1.41 1.41zM5.99 19.41l-1.4 1.4-1.41-1.41 1.4-1.4c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41z"/>
      </svg>
      <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>
      </svg>
    </button>
  </div>
  
  <div class="chat-nav">
    <a href="#" class="nav-link prev-link" id="prevLink">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
      </svg>
    </a>
    <h2 class="chat-title" id="chat-nav-title">Loading conversation...</h2>
    <a href="#" class="nav-link next-link" id="nextLink">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
      </svg>
    </a>
  </div>
  
  <div id="chat-container">
    <div id="loading" class="loading-indicator">Loading conversation...</div>
    <div id="markdown-content" class="markdown-body" style="display: none;"></div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Theme toggle functionality
      const toggleButton = document.getElementById('theme-toggle');
      
      // Toggle theme on button click
      toggleButton.addEventListener('click', function() {
        const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        
        // Optionally re-highlight code to pick up theme changes
        if (window.Prism) {
          setTimeout(() => Prism.highlightAll(), 50);
        }
      });
      
      // Get the conversation path from URL
      const urlParams = new URLSearchParams(window.location.search);
      const path = urlParams.get('path');
      
      if (!path) {
        document.getElementById('loading').textContent = 'Error: No conversation specified';
        return;
      }

      // Main function to load and display the chat
      const loadChat = async () => {
        try {
          // Initialize the chat scanner
          await window.chatScanner.init();
          
          // Set up navigation using the scanner
          const navigation = window.chatScanner.getNavigation(path);
          updateNavigation(navigation);
          
          // Fetch the markdown file
          const response = await fetch(path);
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          
          const markdown = await response.text();
          
          // Extract title from markdown if available
          const titleMatch = markdown.match(/^#\s+(.+)$/m);
          const fileName = path.split('/').pop().replace('.md', '');
          const pageTitle = titleMatch ? titleMatch[1].trim() : fileName;
          
          // Update page title and navigation title
          document.title = `machine yearning - ${pageTitle}`;
          document.getElementById('chat-nav-title').textContent = pageTitle;
          
          // Display the markdown
          const markdownContent = document.getElementById('markdown-content');
          markdownContent.style.display = 'block';
          document.getElementById('loading').style.display = 'none';
          
          // Initialize the chat converter with our fetched content
          initChatConverter({
            rawMarkdown: markdown,
            navConfig: {
              prevLink: navigation.prev ? `chat-viewer.html?path=${navigation.prev.path}` : null,
              nextLink: navigation.next ? `chat-viewer.html?path=${navigation.next.path}` : null,
              title: pageTitle
            },
            showTitle: false
          });
          
          // Enhance code blocks once chat is converted
          setTimeout(enhanceCodeBlocks, 500);
        } catch (error) {
          console.error('Error loading chat:', error);
          document.getElementById('loading').textContent = `Error loading conversation: ${error.message}`;
        }
      };
      
      // Update the navigation links
      function updateNavigation(navigation) {
        const prevLink = document.getElementById('prevLink');
        const nextLink = document.getElementById('nextLink');
        
        if (navigation.prev) {
          prevLink.href = `chat-viewer.html?path=${navigation.prev.path}`;
          prevLink.classList.remove('disabled');
        } else {
          prevLink.classList.add('disabled');
          prevLink.href = '#';
        }
        
        if (navigation.next) {
          nextLink.href = `chat-viewer.html?path=${navigation.next.path}`;
          nextLink.classList.remove('disabled');
        } else {
          nextLink.classList.add('disabled');
          nextLink.href = '#';
        }
      }
      
      // Start loading the chat
      loadChat();
    });
  </script>
  
  <style>
    .loading-indicator {
      text-align: center;
      padding: 2rem;
      color: var(--muted-color);
      font-style: italic;
    }
  </style>
</body>
</html> 